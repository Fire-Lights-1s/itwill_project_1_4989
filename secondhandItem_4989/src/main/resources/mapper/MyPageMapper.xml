<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.itwillbs.mapper.MyPageMapper">
	<select id="getProductList" resultType="com.itwillbs.domain.ProductDTO">
		select * from Product
		where seller_id = #{seller_id}
		<if test="sale == 'pro'">
			and trade_status = '거래 가능' 
		</if>
		<if test="sale == 'com'">
			and trade_status = '거래 완료' 
		</if>
		<if test="sale == 'rsv'">
			and trade_status = '예약 중' 
		</if>
		<if test="sort == 'priceDesc'">
			order by field(trade_status, '거래 중', '예약 중', '거래 완료'), product_price desc
		</if>
		<if test="sort == 'priceAsc'">
			order by field(trade_status, '거래 중', '예약 중', '거래 완료'), product_price
		</if>
		<if test="sort == 'dateDesc'">
			order by field(trade_status, '거래 중', '예약 중', '거래 완료'), created_datetime desc
		</if>
		<if test="sort == 'dateAsc'">
			order by field(trade_status, '거래 중', '예약 중', '거래 완료'), created_datetime
		</if>
		<if test="sort == null or sort == ''">
			order by field(trade_status, '거래 중', '예약 중', '거래 완료'), created_datetime desc
		</if>
		limit #{startRow},#{pageSize}
	</select>
		
	<select id="getProductCount" resultType="java.lang.Integer">
		select count(*) from Product
		where seller_id = #{seller_id}
		<if test="sale == 'pro'">
			and trade_status = '거래 가능' 
		</if>
		<if test="sale == 'com'">
			and trade_status = '거래 완료' 
		</if>
	</select>
	
	<select id="getZzimList" resultType="com.itwillbs.domain.ProductDTO">
		select * from 
		Zzim z join Product p
		on z.product_id = p.product_id
		where z.member_id = #{seller_id}
		<if test="sort == 'priceDesc'">
			order by p.product_price desc
		</if>
		<if test="sort == 'priceAsc'">
			order by p.product_price
		</if>
		<if test="sort == 'dateDesc'">
			order by p.created_datetime desc
		</if>
		<if test="sort == 'dateAsc'">
			order by p.created_datetime
		</if>
		<if test="sort == null or sort == ''">
			order by p.created_datetime desc
		</if>
		limit #{startRow},#{pageSize}
	</select>
	
	<select id="getZzimCount" resultType="java.lang.Integer">
		select count(*) from Zzim
		where member_id = #{seller_id}
	</select>
	
	<delete id="deleteZzim">
		delete from Zzim
		where member_id = #{member_id}
		and product_id = #{product_id}
	</delete>
	
	<select id="getBuyList" resultType="com.itwillbs.domain.ProductDTO">
		select * from 
		Product p join TX t
		on p.product_id = t.product_id
		where t.buyer_id = #{seller_id}
		<if test="sale == 'pro'">
			and t.is_reserved = true
		</if>
		<if test="sale == 'com'">
			and t.is_reserved = false 
		</if>
		<if test="sort == 'priceDesc'">
			order by t.is_reserved desc, p.product_price desc
		</if>
		<if test="sort == 'priceAsc'">
			order by t.is_reserved desc, p.product_price
		</if>
		<if test="sort == 'dateDesc'">
			order by t.is_reserved desc, p.created_datetime desc
		</if>
		<if test="sort == 'dateAsc'">
			order by t.is_reserved desc, p.created_datetime
		</if>
		<if test="sort == null or sort == ''">
			order by t.is_reserved desc, p.created_datetime desc
		</if>
		limit #{startRow},#{pageSize}
	</select>
	
	<select id="getBuyCount" resultType="java.lang.Integer">
		select count(*) from TX
		where product_id = #{seller_id}
		<if test="sale == 'pro'">
			and is_reserved = true 
		</if>
		<if test="sale == 'com'">
			and is_reserved = false 
		</if>
	</select>
</mapper>

